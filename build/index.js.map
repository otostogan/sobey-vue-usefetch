{"version":3,"sources":["../src/index.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/no-explicit-any\nimport { reactive, UnwrapRef, ref, onBeforeUnmount } from \"vue\";\n\nexport enum RequestStatus {\n\tINIT = \"init\",\n\tLOADING = \"loading\",\n\tFULFILLED = \"fulfilled\",\n\tREJECTED = \"rejected\",\n}\n\nexport interface State<T> {\n\tdata: T | null;\n\tstatus: RequestStatus;\n\terror: any | null;\n}\n\nexport type RequestFunction<T, A> = (args: A) => Promise<T>;\n\nexport interface IOptions<T, A = void> {\n\trequest: RequestFunction<T, A>;\n\tdefaultData?: T;\n}\n\nexport function useFetch<T, A = void>({\n\trequest,\n\tdefaultData,\n}: IOptions<T, A>): [\n\tState<T>,\n\t(args?: A, refetch?: number) => Promise<T>,\n\t() => void,\n\tnumber | null\n] {\n\tconst interval = ref<number | null>(null);\n\n\tconst state = reactive<State<T>>({\n\t\tdata: defaultData ? defaultData : null,\n\t\tstatus: RequestStatus.INIT,\n\t\terror: null,\n\t});\n\n\tconst useFetch = async (args?: A, refetch?: number) => {\n\t\tconst fetch = () => {\n\t\t\tstate.status = RequestStatus.LOADING;\n\t\t\treturn request(args!)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tstate.data = response as unknown as UnwrapRef<T>;\n\t\t\t\t\tstate.status = RequestStatus.FULFILLED;\n\t\t\t\t\tstate.error = null;\n\t\t\t\t\treturn response;\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t\tstate.error = error;\n\t\t\t\t\tstate.status = RequestStatus.REJECTED;\n\t\t\t\t\tthrow error;\n\t\t\t\t});\n\t\t};\n\t\tif (refetch) {\n\t\t\tinterval.value = setInterval(() => {\n\t\t\t\tfetch();\n\t\t\t}, refetch);\n\n\t\t\treturn Promise.resolve(state.data as T);\n\t\t} else {\n\t\t\treturn fetch();\n\t\t}\n\t};\n\n\tconst resetInterval = () => {\n\t\tif (interval.value) {\n\t\t\tclearInterval(interval.value);\n\t\t\tinterval.value = null;\n\t\t}\n\t};\n\n\tonBeforeUnmount(() => {\n\t\tresetInterval();\n\t});\n\n\treturn [state as State<T>, useFetch, resetInterval, interval.value];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,iBAA0D;AAEnD,IAAK,gBAAL,kBAAKA,mBAAL;AACN,EAAAA,eAAA,UAAO;AACP,EAAAA,eAAA,aAAU;AACV,EAAAA,eAAA,eAAY;AACZ,EAAAA,eAAA,cAAW;AAJA,SAAAA;AAAA,GAAA;AAoBL,SAAS,SAAsB;AAAA,EACrC;AAAA,EACA;AACD,GAKE;AACD,QAAM,eAAW,gBAAmB,IAAI;AAExC,QAAM,YAAQ,qBAAmB;AAAA,IAChC,MAAM,cAAc,cAAc;AAAA,IAClC,QAAQ;AAAA,IACR,OAAO;AAAA,EACR,CAAC;AAED,QAAMC,YAAW,CAAO,MAAU,YAAqB;AACtD,UAAM,QAAQ,MAAM;AACnB,YAAM,SAAS;AACf,aAAO,QAAQ,IAAK,EAClB,KAAK,CAAC,aAAa;AACnB,cAAM,OAAO;AACb,cAAM,SAAS;AACf,cAAM,QAAQ;AACd,eAAO;AAAA,MACR,CAAC,EACA,MAAM,CAAC,UAAU;AACjB,gBAAQ,MAAM,KAAK;AACnB,cAAM,QAAQ;AACd,cAAM,SAAS;AACf,cAAM;AAAA,MACP,CAAC;AAAA,IACH;AACA,QAAI,SAAS;AACZ,eAAS,QAAQ,YAAY,MAAM;AAClC,cAAM;AAAA,MACP,GAAG,OAAO;AAEV,aAAO,QAAQ,QAAQ,MAAM,IAAS;AAAA,IACvC,OAAO;AACN,aAAO,MAAM;AAAA,IACd;AAAA,EACD;AAEA,QAAM,gBAAgB,MAAM;AAC3B,QAAI,SAAS,OAAO;AACnB,oBAAc,SAAS,KAAK;AAC5B,eAAS,QAAQ;AAAA,IAClB;AAAA,EACD;AAEA,kCAAgB,MAAM;AACrB,kBAAc;AAAA,EACf,CAAC;AAED,SAAO,CAAC,OAAmBA,WAAU,eAAe,SAAS,KAAK;AACnE;","names":["RequestStatus","useFetch"]}